<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Naver Map Test</title>
    <style>
        body { font-family: Arial, Helvetica, sans-serif; margin: 20px; }
        #map { width: 100%; height: 500px; border: 1px solid #ddd; }
    </style>
    <!-- Use current API parameter name (ncpKeyId) and callback per the official tutorial -->
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=wohmf5ntoz&callback=init"></script>
</head>
<body>
    <h1>ë„¤ì´ë²„ ì§€ë„ ì¸ì¦ í…ŒìŠ¤íŠ¸</h1>
    <p>Client ID: <strong>wohmf5ntoz</strong></p>
    <div id="map">ì§€ë„ ë¡œë”© ì¤‘...</div>

    <script>
        console.log('test_naver.html ë¡œë“œ');
        function init() {
            console.log('window.naver:', window.naver);
            if (!window.naver || !window.naver.maps) {
                document.getElementById('map').innerText = 'ë„¤ì´ë²„ ë§µ API ë¡œë”© ì‹¤íŒ¨ - ì½˜ì†” í™•ì¸';
                return;
            }
            try {
                var map = new naver.maps.Map('map', {
                    center: new naver.maps.LatLng(37.5665, 126.9780),
                    zoom: 12
                });
                console.log('ë„¤ì´ë²„ ë§µ ìƒì„± ì„±ê³µ');
            } catch (e) {
                console.error('ë§µ ìƒì„± ì—ëŸ¬:', e);
                document.getElementById('map').innerText = 'ë§µ ìƒì„± ì—ëŸ¬: ' + e.message;
            }
        }

        // ê¸°ì¡´ í´ë°±: APIê°€ ìë™ìœ¼ë¡œ callback(init)ì„ í˜¸ì¶œí•˜ë¯€ë¡œ ì¶”ê°€ í´ë§ì€ ì•ˆì „ì¥ì¹˜ë¡œ ìœ ì§€
        setTimeout(function() {
            if (window.naver && window.naver.maps) {
                init();
            } else {
                console.warn('ë„¤ì´ë²„ API ì¤€ë¹„ë˜ì§€ ì•ŠìŒ, 500ms í›„ ì¬ì‹œë„');
                setTimeout(function() {
                    if (window.naver && window.naver.maps) init();
                    else document.getElementById('map').innerText = 'ë„¤ì´ë²„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤ (ì½˜ì†” í™•ì¸)';
                }, 500);
            }
        }, 200);
    </script>

    <!-- ì¸ì¦ ì‹¤íŒ¨(ì„œë²„ ì¸¡ì—ì„œ ì¸ì¦ ì˜¤ë¥˜ ë°œìƒ ì‹œ í˜¸ì¶œë˜ëŠ” ì „ì—­ í›…) -->
    <script>
        window.navermap_authFailure = function() {
            console.error('ë„¤ì´ë²„ ë§µ ì¸ì¦ ì‹¤íŒ¨: window.navermap_authFailure í˜¸ì¶œë¨');
            const el = document.getElementById('map');
            if (el) {
                el.innerHTML = `\n                    <div style="color: #dc3545; text-align: center; padding: 30px; background: #fff7f7; border: 1px solid #f5c6cb; border-radius: 8px;">\n                        <h3>ğŸ›‘ ë„¤ì´ë²„ ì§€ë„ ì¸ì¦ ì‹¤íŒ¨</h3>\n                        <p>API í‚¤ ë˜ëŠ” í—ˆìš© ì¶œì²˜(Referer)ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>\n                        <p>Client ID: <strong>wohmf5ntoz</strong></p>\n                        <small>ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì˜ Network íƒ­ì—ì„œ maps.js ì‘ë‹µ ë©”ì‹œì§€ë¥¼ í™•ì¸í•œ í›„, Naver Cloud ì½˜ì†”ì˜ í—ˆìš© ì¶œì²˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</small>\n                    </div>\n                `;
            }
        };
    </script>

        <!-- ì§„ë‹¨ìš©: maps.js ì§ì ‘ fetch ì‹œë„ -> ì‘ë‹µ ìƒíƒœ/ë³¸ë¬¸ì„ ì½˜ì†”ì— ì¶œë ¥ (ì¸ì¦ ì‹¤íŒ¨ ë‚´ìš©ì„ í™•ì¸í•˜ê¸° ìœ„í•¨) -->
        <script>
            (function diagnosticFetch(){
                // diagnostic: use the same URL format the tutorial recommends
                const url = 'https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=wohmf5ntoz';
                console.log('diagnostic: fetching', url);
                fetch(url, { method: 'GET', mode: 'cors' })
                    .then(async res => {
                        console.log('diagnostic: fetch status', res.status, res.statusText);
                        try {
                            const text = await res.text();
                            console.log('diagnostic: fetch response (first 2000 chars)');
                            console.log(text.substring(0, 2000));
                        } catch (err) {
                            console.error('diagnostic: failed to read response text', err);
                        }
                    })
                    .catch(err => {
                        console.error('diagnostic: fetch error (possible CORS/network)', err);
                    });
            })();
        </script>
</body>
</html>